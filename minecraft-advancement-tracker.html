<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft Advancement Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #4CAF50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .player-select {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .player-select label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #4CAF50;
        }

        select {
            width: 100%;
            padding: 12px;
            background-color: #3a3a3a;
            color: #e0e0e0;
            border: 2px solid #4CAF50;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #66BB6A;
        }

        .stats {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .stats span {
            font-size: 1.2em;
            color: #4CAF50;
            font-weight: bold;
        }

        .advancement-category {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .category-header {
            font-size: 1.5em;
            color: #4CAF50;
            margin-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .advancement-item {
            background-color: #3a3a3a;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #4CAF50;
        }

        .advancement-item:hover {
            background-color: #454545;
            transform: translateX(5px);
        }

        .advancement-item.hidden {
            display: none;
        }

        .advancement-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 8px;
        }

        .advancement-description {
            color: #b0b0b0;
            font-size: 0.95em;
            margin-bottom: 8px;
        }

        .advancement-progress {
            color: #4CAF50;
            font-size: 0.9em;
            font-style: italic;
            margin-bottom: 10px;
        }

        .missing-items {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4a4a4a;
        }

        .missing-items-title {
            color: #FFD700;
            font-size: 0.9em;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .missing-item {
            display: inline-block;
            background-color: #2a2a2a;
            padding: 5px 10px;
            margin: 3px;
            border-radius: 4px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #555;
        }

        .missing-item:hover {
            background-color: #3a3a3a;
            border-color: #4CAF50;
        }

        .missing-item.checked {
            background-color: #1a1a1a;
            color: #666;
            text-decoration: line-through;
            border-color: #333;
        }

        .no-advancements {
            text-align: center;
            padding: 40px;
            color: #888;
            font-size: 1.2em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #4CAF50;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚õèÔ∏è Minecraft Advancement Tracker</h1>
        
        <div class="player-select">
            <label for="playerSelect">Select Player:</label>
            <select id="playerSelect" disabled>
                <option value="">-- Loading data... --</option>
                <option value="david">David</option>
                <option value="lawrence">Lawrence</option>
            </select>
        </div>

        <div id="stats" class="stats" style="display: none;">
            <span id="statsText"></span>
        </div>

        <div id="advancementsList"></div>
    </div>

    <script>
        let playerData = null;
        let allAdvancements = {};
        let hiddenAdvancements = new Set();
        let checkedItems = {};
        let isDataLoaded = false;

        // Load all JSON files
        Promise.all([
            fetch('minecraft_advancements.json').then(r => r.json()),
            fetch('David.json').then(r => r.json()),
            fetch('Lawrence.json').then(r => r.json())
        ]).then(([advancementsData, davidData, lawrenceData]) => {
            // Store player data
            window.davidData = davidData;
            window.lawrenceData = lawrenceData;
            
            // Process minecraft_advancements.json to create a lookup
            allAdvancements = processAdvancementsData(advancementsData);
            isDataLoaded = true;
            
            // Enable the select dropdown
            document.getElementById('playerSelect').disabled = false;
        }).catch(error => {
            console.error('Error loading data:', error);
            document.getElementById('advancementsList').innerHTML = 
                '<div class="no-advancements">‚ùå Error loading advancement data</div>';
        });

        function processAdvancementsData(data) {
            const advancements = {};
            
            // Process each tab
            for (const [tabName, tabAdvancements] of Object.entries(data)) {
                tabAdvancements.forEach(advancement => {
                    // Create a key from the advancement name
                    // This is a simplified mapping - you may need to adjust based on actual keys
                    const key = nameToKey(advancement.name, tabName);
                    advancements[key] = {
                        name: advancement.name,
                        description: advancement.description,
                        requirement: advancement.requirement,
                        tab: tabName.replace('_tab', ''),
                        type: advancement.type || 'task',
                        hidden: advancement.hidden || false
                    };
                });
            }
            
            return advancements;
        }

        function nameToKey(name, tabName) {
            // Convert advancement name to minecraft key format
            // This creates a standardized key based on the tab and name
            const tab = tabName.replace('_tab', '');
            const simpleName = name.toLowerCase()
                .replace(/[^a-z0-9\s]/g, '')
                .replace(/\s+/g, '_');
            
            return `minecraft:${tab}/${simpleName}`;
        }

        document.getElementById('playerSelect').addEventListener('change', function() {
            const player = this.value;
            if (player === 'david') {
                playerData = window.davidData;
            } else if (player === 'lawrence') {
                playerData = window.lawrenceData;
            } else {
                playerData = null;
            }
            displayAdvancements();
        });

        function displayAdvancements() {
            const listContainer = document.getElementById('advancementsList');
            const statsContainer = document.getElementById('stats');
            const statsText = document.getElementById('statsText');
            
            if (!isDataLoaded) {
                listContainer.innerHTML = '<div class="loading">Loading advancement data...</div>';
                statsContainer.style.display = 'none';
                return;
            }
            
            if (!playerData) {
                listContainer.innerHTML = '<div class="loading">Please select a player</div>';
                statsContainer.style.display = 'none';
                return;
            }

            // Find all incomplete advancements
            const incompleteAdvancements = [];
            
            // Check each advancement key in the player data
            for (const [key, data] of Object.entries(playerData)) {
                // Skip recipe advancements
                if (key.includes('recipes/')) continue;
                
                // Check if advancement is not done and not hidden
                if (!data.done && !hiddenAdvancements.has(key)) {
                    const criteria = Object.keys(data.criteria || {});
                    const criteriaCount = criteria.length;
                    
                    // Try to find advancement info from our loaded data
                    let advInfo = findAdvancementInfo(key, allAdvancements);
                    
                    incompleteAdvancements.push({
                        key,
                        name: advInfo.name || formatKeyToName(key),
                        description: advInfo.description || 'Complete this advancement',
                        tab: advInfo.tab || 'unknown',
                        criteria: criteria,
                        criteriaCount: criteriaCount,
                        type: advInfo.type || 'task'
                    });
                }
            }

            if (incompleteAdvancements.length === 0) {
                listContainer.innerHTML = '<div class="no-advancements">üéâ All advancements completed!</div>';
                statsContainer.style.display = 'none';
                return;
            }

            // Group by tab
            const grouped = {};
            incompleteAdvancements.forEach(adv => {
                if (!grouped[adv.tab]) {
                    grouped[adv.tab] = [];
                }
                grouped[adv.tab].push(adv);
            });

            statsText.textContent = `${incompleteAdvancements.length} incomplete advancement${incompleteAdvancements.length !== 1 ? 's' : ''}`;
            statsContainer.style.display = 'block';

            let html = '';
            
            // Sort tabs
            const tabOrder = ['minecraft', 'adventure', 'nether', 'the_end', 'husbandry'];
            const sortedTabs = Object.keys(grouped).sort((a, b) => {
                const aIndex = tabOrder.indexOf(a);
                const bIndex = tabOrder.indexOf(b);
                if (aIndex === -1 && bIndex === -1) return 0;
                if (aIndex === -1) return 1;
                if (bIndex === -1) return -1;
                return aIndex - bIndex;
            });
            
            sortedTabs.forEach(tab => {
                const advancements = grouped[tab];
                html += `<div class="advancement-category">`;
                html += `<div class="category-header">${formatTabName(tab)} (${advancements.length})</div>`;
                
                advancements.forEach(adv => {
                    const typeIcon = adv.type === 'challenge' ? '‚≠ê' : adv.type === 'goal' ? 'üéØ' : 'üìã';
                    
                    let criteriaHtml = '';
                    if (adv.criteria.length > 0) {
                        criteriaHtml = `
                            <div class="missing-items">
                                <div class="missing-items-title">Completed criteria (${adv.criteriaCount}):</div>
                                ${adv.criteria.slice(0, 10).map(c => 
                                    `<span class="missing-item" style="background-color: #1a3a1a; border-color: #2d5a2d;">${c.replace('minecraft:', '')}</span>`
                                ).join('')}
                                ${adv.criteria.length > 10 ? `<span class="missing-item">... and ${adv.criteria.length - 10} more</span>` : ''}
                            </div>
                        `;
                    }

                    html += `
                        <div class="advancement-item" data-key="${adv.key}">
                            <div class="advancement-name" style="cursor: pointer;">‚òê ${typeIcon} ${adv.name}</div>
                            <div class="advancement-description">${adv.description}</div>
                            ${criteriaHtml}
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            listContainer.innerHTML = html;

            // Add click handlers to hide advancements
            document.querySelectorAll('.advancement-item').forEach(item => {
                const nameElement = item.querySelector('.advancement-name');
                nameElement.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const key = item.dataset.key;
                    hiddenAdvancements.add(key);
                    item.classList.add('hidden');
                    displayAdvancements();
                });
            });
        }

        function findAdvancementInfo(key, allAdvancements) {
            // Try direct match first
            if (allAdvancements[key]) {
                return allAdvancements[key];
            }
            
            // Try to find by matching the key pattern
            for (const [advKey, advInfo] of Object.entries(allAdvancements)) {
                if (key === advKey) {
                    return advInfo;
                }
            }
            
            // Return default if not found
            return {
                name: formatKeyToName(key),
                description: 'Complete this advancement',
                tab: key.split('/')[0].replace('minecraft:', '') || 'unknown',
                type: 'task'
            };
        }

        function formatKeyToName(key) {
            // Convert key like "minecraft:story/mine_stone" to "Mine Stone"
            const parts = key.split('/');
            const name = parts[parts.length - 1];
            return name.split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        function formatTabName(tab) {
            // Format tab name for display
            return tab.split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        displayAdvancements();
    </script>
</body>
</html>